====================================
Installing ONIE on ot-molex (Intel X6425E) platform with UEFI
====================================

Prerequisites 
====================

1. ot-molex (Intel X6425E) platform
2. UEFI as primary bootloader
3. Grub2 as Coreboot payload
4. console connection with the same baud rate as your UEFI settings are


Cross-Compiling ONIE
====================

Because we are builing grub with coreboot support we have to install additional packages first prior of compiling ONIE.
All those packages are integrated into a script.
for ubuntu based system you can:

# sudo sh machine/molex/ot-molex/build-env.sh

To compile ONIE change directories to ``build-config`` and then
type ``"make MACHINEROOT=../machine/molex MACHINE=ot-molex all"``.
For example::

  $ cd build-config
  $ make -j4 MACHINEROOT=../machine/molex MACHINE=ot-molex all

When complete, the ONIE binaries are located in
``build/images``::

-rw-rw-r-- 1 sonic sonic 28311552 Feb 20 00:48 onie-recovery-x86_64-ot-molex-r0.iso
-rw-rw-r-- 1 sonic sonic 13365242 Feb 20 00:48 onie-updater-x86_64-ot-molex-r0
-rw-rw-r-- 1 sonic sonic  7457380 Feb 20 00:47 ot-molex-r0.initrd
-rw-rw-r-- 1 sonic sonic  5854880 Feb 20 00:48 ot-molex-r0.vmlinuz


ot-molex-r0.vmlinuz                  -- This is the ONIE kernel image

ot-molex-r0.initrd                   -- This is the ONIE initramfs (filesystem)

onie-updater-x86_64-ot-molex-r0      -- This is the ONIE self-update image.
                                        This image is a self-extracting archive used for installing ONIE.

onie-recovery-x86_64-ot-molex-r0.iso -- This is iso image containing ONIE kernel + ONIE initramfs with ONIE self-update image already included inside.
                                        This might be very useful as it can be easily placed on USB/CD and one can boot from this to install/reinstall/repair ONIE
										   
Installation steps
====================

1. Put your onie-recovery-x86_64-ot-molex-r0.iso onto USB
   # dd if=onie-recovery-x86_64-ot-molex-r0.iso of=/dev/sdX bs=1M

2. Shutdown you platform and place you usb stick onto the platform

3. Boot to your coreboot's grub2

4. Press 'c' and type:
   grub> insmod ehci
   grub> search -n --set root -l ONIE-RECOVERY
   grub> echo $root
   
You should see something like:

  usb0,msdos1
  
Now load new grub configuration file:

  grub> configfile ($root)/boot/grub/grub.cfg
  
After that you should see:


                     GNU GRUB  version 2.02~beta2+e4a1fe391

 +----------------------------------------------------------------------------+
 |*ONIE: Install OS                                                           |
 | ONIE: Rescue                                                               |
 | ONIE: Uninstall OS                                                         |
 | ONIE: Update ONIE                                                          |
 | ONIE: Embed ONIE                                                           |
 |                                                                            |
 |                                                                            |
 |                                                                            |
 |                                                                            |
 |                                                                            |
 |                                                                            |
 |                                                                            |
 +----------------------------------------------------------------------------+

